<!DOCTYPE html>
<html> 
<head>
    <link rel="stylesheet" href="../../../style.css">
    <link rel="stylesheet" href="../../../test_menu.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css?family=PT+Serif&Merriweather&Oswald&Ubuntu+Mono&Arimo:ital,wght@0,400..700;1,400..700" rel="stylesheet">
    <title>Extremely soft blog launch!</title>
    <link rel="stylesheet" href="../../theme/css/code.css">
    <!&ndash; FOR KATEX &ndash;>
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/katex/dist/katex.min.css"
          crossorigin="anonymous">
    <link href="feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Michael Saxon Full Atom Feed" />
    <link href="feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="Michael Saxon Full RSS Feed" />
    <meta name="title" content="Extremely soft blog launch!" />
    <meta name="description" content="To test that my blog implementation works, I'll share my pytorchlightning-based replication of dataset cartography!" />
    <!&ndash; Open Graph / Facebook &ndash;>
    <meta property="og:type" content="article" />
    <meta property="og:url" content="https://saxon.me/" />
    <meta property="og:title" content="Extremely soft blog launch!" />
    <meta property="og:description" content="To test that my blog implementation works, I'll share my pytorchlightning-based replication of dataset cartography!" />
    <meta property="og:image" content="" />

    <!&ndash; Twitter &ndash;>
    <meta property="twitter:card" content="summary" />
    <meta property="twitter:site" content="https://saxon.me/" />
    <meta property="twitter:creator" content="@m2saxon" />
    <meta property="twitter:title" content="Extremely soft blog launch!" />
    <meta property="twitter:description" content="To test that my blog implementation works, I'll share my pytorchlightning-based replication of dataset cartography!" />
    <meta property="twitter:image" content="" />
</head>
<body>

<header>
  <div class="top-nav">
  <!&ndash;div class="menucontainer"&ndash;>
  <div style="margin-right: auto;">
  <h1><a href="../../../">Michael Saxon</a></h1>
  </div>
  <input id="menu-toggle" type="checkbox" />
  <label class='menu-button-container' for="menu-toggle">
  <div class='menu-button'></div>
</label>
  <ul class="menu">
    <li><a href="../../../research">Publications</a></li>
    <li><a href="../../../doc/cv_saxon.pdf">CV</a></li>
  <li><a href="../..">Blog</a></li>
  </ul>
</div>
</header>




<div class="page" style="word-spacing: 0.09em;">
    <h1 style="margin-top: 0; margin-bottom: 5pt;"><a href="../../2023/softlaunch/" rel="bookmark"
         title="Permalink to Extremely soft blog launch!" style="color: rgb(81, 89, 55);">Extremely soft blog launch!</a></h1>

    <p><i style="font-size: 10pt;">Sat 03 June 2023</i><br></p>
    <hr>
    <h3>About my blog</h3>
<p>I have thoughts I'd like to share from time-to-time. I have been testing my Pelican-based blog generator for a while and got it working, but a lack of fully-formed blogpost ideas to upload has consequently kept me from updating my website for months. This has become a problem for me as news and results have accumulated. Thus at this point, I have no choice but to push a placeholder blogpost such as this. Looking forward to making a more substantial post soon ðŸ«¡</p>
<h3>Implemented in PL</h3>
<p>Check out this code! You can pass in any <code>Callback</code> object from pytorch lightning, to track the training process of a model in pytorch lightning. This automatically collects the training dynamics statistics and writes them to a given output csv file for future processing and analysis!</p>
<div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">CartographyCallback</span><span class="p">(</span><span class="n">Callback</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_base</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">output_base</span> <span class="o">=</span> <span class="n">output_base</span>

    <span class="k">def</span> <span class="nf">init_buffers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trainer</span><span class="p">):</span>
        <span class="n">key_nums</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;train&quot;</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">trainer</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">train</span><span class="p">),</span>
            <span class="s2">&quot;val&quot;</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">trainer</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">valid</span><span class="p">),</span>
            <span class="s2">&quot;test&quot;</span> <span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">trainer</span><span class="o">.</span><span class="n">datamodule</span><span class="o">.</span><span class="n">test</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">confidences</span> <span class="o">=</span> <span class="n">define_samplewise_metric</span><span class="p">(</span><span class="n">key_nums</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">correctnesses</span> <span class="o">=</span> <span class="n">define_samplewise_metric</span><span class="p">(</span><span class="n">key_nums</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">cartography_save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">epoch</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_base</span><span class="si">}</span><span class="s2">/conf_</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">epoch</span><span class="si">}</span><span class="s2">.npy&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">confidences</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">output_base</span><span class="si">}</span><span class="s2">/corr_</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">epoch</span><span class="si">}</span><span class="s2">.npy&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">correctnesses</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">batch_end_accumulate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="n">targets</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="n">logits</span> <span class="o">=</span> <span class="n">outputs</span><span class="p">[</span><span class="s1">&#39;logits&#39;</span><span class="p">]</span>
        <span class="n">preds</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">logits</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">indices</span>
        <span class="n">batch_idces</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="s1">&#39;idx&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">confidences</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">batch_idces</span><span class="p">]</span> <span class="o">=</span> <span class="n">confidence_elementwise</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">logits</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">correctnesses</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="n">batch_idces</span><span class="p">]</span> <span class="o">=</span> <span class="n">correct_elementwise</span><span class="p">(</span><span class="n">targets</span><span class="p">,</span> <span class="n">preds</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">on_train_batch_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trainer</span><span class="p">,</span> <span class="n">pl_module</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">batch_idx</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_end_accumulate</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="s2">&quot;train&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">on_validation_batch_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trainer</span><span class="p">,</span> <span class="n">pl_module</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">batch_idx</span><span class="p">,</span> <span class="n">dataloader_idx</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_end_accumulate</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="s2">&quot;val&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">on_test_batch_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trainer</span><span class="p">,</span> <span class="n">pl_module</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">batch_idx</span><span class="p">,</span> <span class="n">dataloader_idx</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_end_accumulate</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">on_train_epoch_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trainer</span><span class="p">,</span> <span class="n">pl_module</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cartography_save</span><span class="p">(</span><span class="n">trainer</span><span class="o">.</span><span class="n">current_epoch</span><span class="p">,</span> <span class="s2">&quot;train&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">on_validation_epoch_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trainer</span><span class="p">,</span> <span class="n">pl_module</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cartography_save</span><span class="p">(</span><span class="n">trainer</span><span class="o">.</span><span class="n">current_epoch</span><span class="p">,</span> <span class="s2">&quot;val&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">on_test_epoch_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trainer</span><span class="p">,</span> <span class="n">pl_module</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cartography_save</span><span class="p">(</span><span class="n">trainer</span><span class="o">.</span><span class="n">current_epoch</span><span class="p">,</span> <span class="s2">&quot;test&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">on_train_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trainer</span><span class="p">,</span> <span class="n">pl_module</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_buffers</span><span class="p">(</span><span class="n">trainer</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">on_sanity_check_start</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">trainer</span><span class="p">,</span> <span class="n">pl_module</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">init_buffers</span><span class="p">(</span><span class="n">trainer</span><span class="p">)</span>
</code></pre></div>

<p>I wrote this code so that I could replicate the <a href="https://arxiv.org/abs/2009.10795">Dataset Cartography</a> features of confidence and correctness to analyze the effectiveness of my <a href="https://arxiv.org/abs/2112.09237">PECO</a> tool for analyzing datasets. You can see the code used in-context <a href="https://github.com/michaelsaxon/DatasetAnalysis">here!</a></p>
    <hr>
    <p style="font-size: 10pt; font-style: italic;">Category: <a href="../../category/about.html">About</a>; Tags: <a href="../../tag/about.html">About</a></p>
    <p style="font-size: 10pt;"><emph>Michael Saxon is a Ph.D. student in Computer Science focusing on NLP at UC Santa Barbara. You can find more of his writing on Twitter <a href="https://twitter.com/m2saxon">@m2saxon</a>.</emph></p>
  


</div>


<footer style="margin-top:25pt; border-top: 1px dotted #676767; padding-top:10pt;"">
  <ul class="icons">
    <li><a href="https://www.semanticscholar.org/author/Michael-Stephen-Saxon/48227633" ><img class="filtercolor" src="../../../img/ico/svg/semantic-scholar.svg"></a></li>
    <li><a href="https://scholar.google.com/citations?user=pAlwjdgAAAAJ&hl=en" ><img class="filtercolor" src="../../../img/ico/svg/google-scholar.svg"></a></li>
    <li><a href="https://www.researchgate.net/profile/Michael_Saxon"><img class="filtercolor" src="../../../img/ico/svg/researchgate.svg"></a></li>
    <li><a href="mailto:saxon@ucsb.edu"><img class="filtercolor" src="../../../img/ico/svg/envelope.svg"></a></li>
    <li><a href="https://github.com/michaelsaxon"><img class="filtercolor" src="../../../img/ico/svg/github-alt.svg"></a></li>
    <li><a href="https://www.youtube.com/@mssaxonUCSB"><img class="filtercolor" src="../../../img/ico/svg/youtube.svg"></a></li>
    <li><a href="https://www.linkedin.com/in/mssaxon/"><img class="filtercolor" src="../../../img/ico/svg/linkedin-in.svg"></a></li>
    <li><a href="https://bsky.app/profile/saxon.me" ><img class="filtercolor" src="../../../img/ico/svg/cloud.svg"></a></li>
    <li><a rel="me" href="https://sigmoid.social/@saxon"><img class="filtercolor" src="../../../img/ico/svg/mastodon.svg"></a></li>
    <li><a href="https://twitter.com/m2saxon" ><img class="filtercolor" src="../../../img/ico/svg/twitter.svg"></a></li>
      
    </ul>

    <div class="worldmap"><script type='text/javascript' id='clustrmaps' src='//cdn.clustrmaps.com/map_v2.js?cl=ffffff&w=a&t=tt&d=IuxqtNT-Q6MDtRyPajTC07_66TRmeCIPbVD4z2v4M_U&co=474747&cmn=547bfc'></script></div>

    <div style="max-width: 800px;   margin-right: auto; margin-left: auto;">
	    <p style="font-size:10pt; text-align: center">Core webpage incrementally scratchbuilt by me. Feel free to steal my source from <a href="https://github.com/michaelsaxon/michaelsaxon.github.io">GitHub</a>. Blog functionality made using <a href="https://getpelican.com/">Pelican</a>.</p>
    </div>

  <!&ndash;div style="width: 90pt; height: 25pt; background-color: #ddd; font-size: 9pt; border: 1pt solid black; margin-right: auto; margin-left: auto;
    background-image: url(https://upload.wikimedia.org/wikipedia/commons/thumb/2/26/Mozilla_Firefox_logo_2004.svg/133px-Mozilla_Firefox_logo_2004.svg.png);
    background-size: 27pt; background-repeat: no-repeat; padding-left:30pt; margin-bottom: 10pt;">
    Designed for <b><a href="https://www.mozilla.org/en-US/firefox/new/" style="color:#e27f2e;">Mozilla Firefox</a></b> on a <b style="color: #0060df;">real PC!</b>
  </div&ndash;>
  
  <div style="max-width: 800px; margin-right: auto; margin-left: auto; text-align: center;">
     <img src="https://web.badges.world/badges/operated/getfirefox.gif"/>
    <img src="https://web.badges.world/badges/operated/linuxpenguin(2).png"/>
    <img src="https://web.badges.world/badges/memes/allyourbase.gif"/>
    <!&ndash;img src="https://web.badges.world/badges/memes/finiqi.gif"/&ndash;>
    <!&ndash;img src="https://web.badges.world/badges/geography/arizonan.gif"/>
    <img src="https://web.badges.world/badges/humor/nightcoder.png"/>
    <img src="https://web.badges.world/badges/games/playstation.gif"/>
    <img src="https://web.badges.world/badges/other/subaru.gif"/>
    <img src="https://web.badges.world/badges/politics/recallbushanim.gif"/>
    <img src="https://web.badges.world/badges/other/slogo_res.png"&ndash;>
  </div>
</footer>


</body>
</html>